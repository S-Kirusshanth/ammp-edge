name: ammp-edge
version: git
summary: Edge application for AMMP
description: |
    Manages data collection and forwarding for AMMP, the Asset Monitoring and Management Platform.
    https://www.ammp.io/
    https://github.com/ammpio/ammp-edge

grade: stable
confinement: strict

apps:
  ammp-edge:
    command: bin/ammp_edge -d
    daemon: simple
    restart-condition: always
#    restart-delay: 60
    plugs:
      - network
      - system-observe
      - hardware-observe
      - network-observe
      - serial-port

parts:
  ammp-edge:
    plugin: python
    python-version: python3
    source: https://github.com/ammpio/ammp-edge.git
    source-branch: master
    stage-packages:
        - libsnmp-dev
        - python3-netifaces
    override-prime: |
        snapcraftctl prime
        # This is the last step, let's now compile all our pyc files.
        # 0 --workers: Use all available CPU threads
        "${SNAPCRAFT_PRIME}"/usr/bin/python3 \
        -m compileall \
        -q \
        --workers 0 \
        "${SNAPCRAFT_PRIME}"
# Just to get the remote cfg YAML file
  ammp-edge-remote-cfg:
    plugin: dump
    source: https://github.com/ammpio/ammp-edge.git
    source-branch: master
    prime:
      - remote.yml
# Get the drivers directory also from git
  drivers:
    plugin: dump
    source: https://github.com/ammpio/ammp-edge.git
    source-branch: master
    prime:
      - drivers
